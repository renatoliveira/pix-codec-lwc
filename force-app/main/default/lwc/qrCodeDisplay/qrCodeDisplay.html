<template>
  <div class="slds-card slds-card_boundary">
    <div class="slds-card__body slds-card__body_inner">
      <!-- Loading State -->
      <template lwc:if={isLoading}>
        <div class="slds-is-relative slds-var-p-around_large">
          <lightning-spinner
            alternative-text="Loading QR Code..."
            size="medium"
          ></lightning-spinner>
        </div>
      </template>

      <!-- Error State -->
      <template lwc:if={hasError}>
        <div
          class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error"
          role="alert"
        >
          <span class="slds-assistive-text">Error</span>
          <lightning-icon
            icon-name="utility:error"
            size="x-small"
            class="slds-var-m-right_x-small"
          ></lightning-icon>
          <h2>{errorMessage}</h2>
        </div>
      </template>

      <!-- QR Code Section -->
      <template lwc:if={shouldShowQRCode}>
        <div class="slds-text-align_center slds-var-m-bottom_large">
          <div class="slds-var-m-bottom_medium">
            <h3 class="slds-text-heading_small slds-var-m-bottom_small">
              QR Code
            </h3>
            <p class="slds-text-body_small slds-text-color_weak">
              Scan with your banking app to make payment
            </p>
          </div>
          <div
            class="qr-code-container slds-box slds-box_x-small slds-theme_shade slds-text-align_center"
            lwc:dom="manual"
            data-id="qrCode"
            data-code={value}
          ></div>
        </div>
      </template>

      <!-- PIX Code Section -->
      <template lwc:if={shouldShowPixCode}>
        <div class="slds-text-align_center slds-var-m-top_large">
          <div class="slds-var-m-bottom_medium">
            <h3 class="slds-text-heading_small slds-var-m-bottom_small">
              PIX Code
            </h3>
            <p class="slds-text-body_small slds-text-color_weak">
              Copy and paste this code in your banking app
            </p>
          </div>

          <div class="slds-form-element">
            <div class="slds-form-element__control">
              <div class="slds-input-has-fixed-addon">
                <input
                  type="text"
                  class="slds-input"
                  readonly
                  value={pixCode}
                  data-field="pixCode"
                />
                <span class="slds-form-element__addon">
                  <button
                    type="button"
                    class="slds-button slds-button_icon slds-button_icon-container"
                    title="Copy PIX Code"
                    onclick={copyPixCode}
                  >
                    <lightning-icon
                      icon-name="utility:copy"
                      size="x-small"
                    ></lightning-icon>
                    <span class="slds-assistive-text">Copy PIX Code</span>
                  </button>
                </span>
              </div>
            </div>
          </div>

          <div class="slds-var-m-top_small">
            <button
              type="button"
              class="slds-button slds-button_neutral slds-button_stretch"
              onclick={copyPixCode}
            >
              <lightning-icon
                icon-name="utility:copy"
                size="x-small"
                class="slds-var-m-right_x-small"
              ></lightning-icon>
              Copy PIX Code
            </button>
          </div>
        </div>
      </template>

      <!-- No Content State -->
      <template if:false={pixCode}>
        <div class="slds-text-align_center slds-var-p-around_large">
          <lightning-icon
            icon-name="utility:info"
            size="large"
            class="slds-var-m-bottom_small"
          ></lightning-icon>
          <p class="slds-text-body_regular slds-text-color_weak">
            No PIX code provided
          </p>
        </div>
      </template>
    </div>
  </div>
</template>
